version: 1.0.0
last_updated: 2024-10-27
ci_pipeline:
  description: >-
    Continuous integration enforces linting, type safety, and multi-layer testing prior to merge.
  stages:
    - name: lint
      command: pnpm -r --if-present lint
    - name: typecheck
      command: pnpm -r --if-present typecheck
    - name: unit
      command: pnpm -r --if-present test:unit
    - name: property
      command: pnpm -r --if-present test:property
    - name: e2e
      command: pnpm -r --if-present test:e2e
    - name: schema
      command: pnpm -r --if-present test:schema
  quality_gates:
    schema_validity_threshold: 0.98
    task_pass_threshold: 0.9
    schema_report_path: reports/schema-validation.json
    task_report_path: reports/test-summary.json
    evaluation_job: .github/workflows/ci.yml::quality-gates
    merge_blocking: true
schema_validation:
  expected_reports:
    - path: reports/schema-validation.json
      description: >-
        JSON report generated by the schema validation suite. The workflow infers
        validity from `.validity` when present, or from `validResponses` divided
        by `totalResponses`.
  governance:
    schema_directory: schemas
    minimum_validity: 0.98
    action_on_failure: Block merge and trigger release rollback workflow.
canary_release:
  initial_traffic: 0.1
  rollback_conditions:
    schema_validity_drop: 0.02
    task_pass_rate_drop: 0.03
    latency_p95_increase: 0.30
  monitoring_sources:
    - name: synthetic_schema_checks
      schema: schemas/canary-metrics.schema.json
    - name: e2e_telemetry
      description: Derived from e2e smoke runs executed during the canary window.
prompt_governance:
  changelog: prompts/changelog.md
  schema_directory: schemas/
  release_checklist: docs/release-checklist.md
  notes: >-
    Any changes to prompts or schemas must be accompanied by an entry in the
    changelog and a checklist run. Updates should reference the CI quality gate
    thresholds.
